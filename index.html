<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CivilConnect</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-muted: #f5f7fb;
    --bg-surface: #ffffff;
    --bg-subtle: #eef1f7;
    --text-primary: #0f172a;
    --text-secondary: #475569;
    --border-soft: #e2e8f0;
    --blue-500: #2563eb;
    --blue-600: #1d4ed8;
    --green-500: #16a34a;
    --amber-500: #f59e0b;
    --shadow-sm: 0 8px 20px rgba(15, 23, 42, 0.08);
  }

  * { margin:0; padding:0; box-sizing:border-box; font-family:'Inter',sans-serif; }
  body {
    min-height:100vh;
    display:flex;
    flex-direction:column;
    background:var(--bg-muted);
    color:var(--text-primary);
  }

  button { cursor:pointer; }

  header {
    position:sticky;
    top:0;
    z-index:20;
    background:var(--bg-surface);
    box-shadow:0 1px 0 rgba(15,23,42,0.08);
  }

  .header-inner {
    max-width:1200px;
    margin:0 auto;
    padding:20px 24px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:16px;
  }

  .brand {
    display:flex;
    align-items:center;
    gap:12px;
    font-weight:700;
    font-size:20px;
    color:var(--blue-600);
  }

  .brand-pill {
    display:inline-flex;
    width:38px;
    height:38px;
    border-radius:12px;
    align-items:center;
    justify-content:center;
    background:linear-gradient(135deg, var(--blue-600), #0ea5e9);
    color:#fff;
    font-weight:700;
  }

  #loginScreen {
    min-height:100vh;
    display:none;
    align-items:center;
    justify-content:center;
    background:var(--bg-muted);
    padding:32px;
  }

  .login-card {
    width:100%;
    max-width:380px;
    background:var(--bg-surface);
    padding:32px;
    border-radius:18px;
    box-shadow:var(--shadow-sm);
    border:1px solid var(--border-soft);
  }

  .login-card h2 {
    font-size:26px;
    margin-bottom:8px;
  }

  .login-card p {
    color:var(--text-secondary);
    margin-bottom:24px;
  }

  .login-field {
    display:flex;
    flex-direction:column;
    gap:8px;
    margin-bottom:18px;
  }

  .login-card label {
    font-weight:600;
    color:var(--text-primary);
    font-size:14px;
  }

  .login-error {
    margin-top:8px;
    color:#dc2626;
    font-size:14px;
    min-height:20px;
  }

  nav {
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    justify-content:center;
  }

  nav button {
    border:none;
    background:transparent;
    color:var(--text-secondary);
    font-weight:600;
    padding:10px 14px;
    border-radius:10px;
    transition:background 0.2s ease, color 0.2s ease, transform 0.2s ease;
  }

  nav button:hover { background:var(--bg-subtle); color:var(--blue-600); }
  nav button.active { background:rgba(37,99,235,0.12); color:var(--blue-600); }

  main {
    flex:1;
    width:100%;
  }

  .container {
    max-width:1200px;
    margin:0 auto;
    padding:32px 24px 48px;
  }

  .content-section { display:none; }
  .content-section.active { display:block; }

  .card {
    background:var(--bg-surface);
    border-radius:18px;
    padding:24px;
    box-shadow:var(--shadow-sm);
  }

  .hero {
    display:grid;
    gap:28px;
    align-items:center;
    background:linear-gradient(135deg, rgba(37,99,235,0.1), rgba(14,165,233,0.12));
    border:1px solid rgba(37,99,235,0.15);
  }

  .hero h1 {
    font-size:34px;
    line-height:1.2;
    margin-bottom:12px;
  }

  .hero p {
    color:var(--text-secondary);
    max-width:560px;
  }

  .action-row {
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    justify-content:center;
    margin-top:20px;
  }

  .btn-primary, .btn-secondary {
    border:none;
    padding:12px 20px;
    border-radius:12px;
    font-weight:600;
    font-size:15px;
    min-width:180px;
  }

  .btn-primary { background:var(--blue-600); color:#fff; }
  .btn-primary:hover { background:#1840b8; }

  .btn-secondary { background:var(--bg-surface); color:var(--blue-600); border:1px solid rgba(29,78,216,0.25); }
  .btn-secondary:hover { background:rgba(37,99,235,0.08); }

  .highlights {
    display:grid;
    gap:20px;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    margin-top:28px;
  }

  .highlight {
    background:var(--bg-surface);
    border-radius:16px;
    padding:20px;
    border:1px solid var(--border-soft);
  }

  .highlight span { display:block; font-size:13px; color:var(--text-secondary); margin-bottom:8px; }
  .highlight strong { font-size:22px; }

  .section-title {
    font-size:22px;
    margin-bottom:18px;
  }

  .grid { display:grid; gap:24px; }
  .grid-3 { grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); }
  .grid-2 { grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); }

  .material-card {
    display:flex;
    flex-direction:column;
    gap:14px;
    border:1px solid rgba(226,232,240,0.8);
  }

  .material-header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
  }

  .material-emoji {
    font-size:36px;
    display:inline-flex;
  }

  .material-category {
    padding:6px 12px;
    border-radius:999px;
    background:rgba(37,99,235,0.1);
    color:var(--blue-600);
    font-weight:600;
    font-size:13px;
  }

  .material-meta {
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-weight:600;
  }

  .material-meta span:last-child { color:var(--text-secondary); font-weight:500; font-size:13px; }

  .material-foot {
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-size:13px;
    color:var(--text-secondary);
  }

  .btn-full {
    width:100%;
    padding:12px 16px;
    border-radius:12px;
    border:none;
    background:var(--blue-600);
    color:#fff;
    font-weight:600;
    transition:background 0.2s ease;
  }

  .btn-full:hover { background:#1840b8; }

  .marketplace-toolbar {
    display:flex;
    flex-wrap:wrap;
    gap:16px;
    align-items:flex-end;
    border:1px solid var(--border-soft);
    background:var(--bg-surface);
    margin-bottom:28px;
  }

  .field {
    display:flex;
    flex-direction:column;
    gap:8px;
    min-width:200px;
  }

  .field span { font-size:13px; color:var(--text-secondary); }

  input, select {
    padding:12px 14px;
    border-radius:12px;
    border:1px solid rgba(148,163,184,0.4);
    background:#fff;
    font-size:14px;
    color:var(--text-primary);
  }

  input:focus, select:focus {
    outline:none;
    border-color:var(--blue-500);
    box-shadow:0 0 0 3px rgba(37,99,235,0.15);
  }

  .cart-card {
    margin-top:32px;
    padding:0;
    overflow:hidden;
  }

  .cart-header {
    padding:24px;
    border-bottom:1px solid var(--border-soft);
    display:flex;
    justify-content:space-between;
    align-items:center;
    flex-wrap:wrap;
    gap:12px;
  }

  .cart-stats {
    display:flex;
    gap:16px;
    flex-wrap:wrap;
    color:var(--text-secondary);
    font-size:13px;
  }

  .cart-body { padding:16px 24px 24px; display:flex; flex-direction:column; gap:18px; }

  .cart-empty {
    padding:40px 24px;
    text-align:center;
    color:var(--text-secondary);
    border:1px dashed var(--border-soft);
    border-radius:14px;
    background:var(--bg-subtle);
  }

  .cart-item {
    display:grid;
    grid-template-columns:1fr auto auto;
    gap:24px;
    padding:24px 0;
    border-bottom:1px solid var(--border-soft);
  }

  .cart-item:last-child { border-bottom:none; }

  .cart-item h4 { font-size:17px; margin-bottom:8px; font-weight:600; }
  .cart-item p { color:var(--text-secondary); font-size:14px; line-height:1.5; }

  .quantity-group {
    display:flex;
    align-items:center;
    gap:12px;
  }

  .quantity-btn {
    width:38px;
    height:38px;
    border-radius:50%;
    border:1px solid var(--border-soft);
    background:var(--bg-surface);
    font-weight:600;
    font-size:16px;
  }

  .quantity-btn:hover { border-color:var(--blue-500); color:var(--blue-600); }

  .text-link {
    border:none;
    background:transparent;
    color:#dc2626;
    font-size:13px;
    font-weight:600;
    text-decoration:underline;
  }

  .cart-summary {
    display:flex;
    justify-content:space-between;
    align-items:flex-end;
    flex-wrap:wrap;
    gap:16px;
    padding-top:24px;
    margin-top:12px;
  }

  .cart-summary h3 { font-size:22px; }
  .cart-summary span { color:var(--text-secondary); font-size:14px; margin-top:6px; display:block; }

  .checkout-btn {
    width:100%;
    padding:16px;
    border:none;
    border-radius:14px;
    font-weight:600;
    font-size:16px;
    background:var(--green-500);
    color:#fff;
    transition:background 0.2s ease;
    margin-top:20px;
  }

  .checkout-btn:hover { background:#15803d; }

  .prof-card {
    display:flex;
    flex-direction:column;
    gap:18px;
    border:1px solid var(--border-soft);
  }

  .prof-card.bookmarked {
    border:2px solid #fef3c7;
  }

  .prof-head {
    display:flex;
    gap:16px;
    align-items:center;
  }

  .prof-avatar {
    width:70px;
    height:70px;
    border-radius:18px;
    background:linear-gradient(135deg, var(--blue-600), #0ea5e9);
    display:flex;
    align-items:center;
    justify-content:center;
    color:#fff;
    font-weight:700;
    font-size:22px;
  }

  .prof-meta { color:var(--text-secondary); font-size:13px; }

  .prof-actions { display:flex; gap:12px; flex-wrap:wrap; }

  .tag {
    display:inline-flex;
    align-items:center;
    gap:6px;
    background:var(--bg-subtle);
    border-radius:999px;
    padding:6px 12px;
    font-size:12px;
    color:var(--text-secondary);
  }

  .calculator-output {
    margin-top:14px;
    background:rgba(37,99,235,0.08);
    border-radius:12px;
    padding:14px;
    font-weight:600;
    color:var(--blue-600);
  }

  .tool-grid {
    display:grid;
    gap:24px;
    grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
  }

  footer {
    background:#fff;
    color:#0f172a;
    text-align:center;
    padding:28px 16px;
    margin-top:auto;
    border-top:1px solid #64748b;
  }

  footer p { font-size:14px; }

  .cart-sidebar {
    position:fixed;
    top:0;
    right:0;
    width:350px;
    height:100vh;
    background:var(--bg-surface);
    box-shadow:-4px 0 20px rgba(0,0,0,0.1);
    transform:translateX(100%);
    transition:transform 0.3s ease;
    z-index:50;
    display:flex;
    flex-direction:column;
  }

  .cart-sidebar.open { transform:translateX(0); }

  .cart-sidebar-header {
    padding:24px;
    border-bottom:1px solid var(--border-soft);
    display:flex;
    justify-content:space-between;
    align-items:center;
  }

  .cart-sidebar-body {
    flex:1;
    padding:32px;
    overflow-y:auto;
  }

  .cart-list {
    margin-bottom:24px;
  }

  .container.sidebar-open { margin-right:350px; }

  .header-inner.sidebar-open { margin-right:350px; }

  #appShell {
    display:flex;
    flex-direction:column;
    min-height:100vh;
  }

  #cartToggle:hover { color: #dc2626; background: rgba(220,38,38,0.1); border-radius:4px; padding:4px 8px; }

  /* Mobile Responsive Styles */
  @media (max-width: 768px) {
    .header-inner {
      flex-direction: column;
      padding: 16px;
    }

    nav {
      width: 100%;
      justify-content: space-between;
    }

    nav button {
      flex: 1;
      font-size: 12px;
      padding: 8px 6px;
    }

    .brand {
      font-size: 18px;
    }

    .hero h1 {
      font-size: 26px;
    }

    .hero p {
      font-size: 14px;
    }

    .action-row {
      flex-direction: column;
    }

    .btn-primary, .btn-secondary {
      width: 100%;
      min-width: auto;
    }

    .highlights {
      grid-template-columns: repeat(2, 1fr);
    }

    .grid-3 {
      grid-template-columns: 1fr;
    }

    .grid-2 {
      grid-template-columns: 1fr;
    }

    .marketplace-toolbar {
      flex-direction: column;
      padding: 16px;
    }

    .field {
      width: 100%;
      min-width: auto;
    }

    .cart-sidebar {
      width: 100%;
    }

    .cart-item {
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .quantity-group {
      justify-content: flex-start;
    }

    .container.sidebar-open {
      margin-right: 0;
    }

    .header-inner.sidebar-open {
      margin-right: 0;
    }

    .tool-grid {
      grid-template-columns: 1fr;
    }

    .prof-head {
      flex-direction: row;
      align-items: flex-start;
      position: relative;
      padding-right: 64px;
    }

    .btn-call {
      position: absolute;
      top: 8px;
      right: 0;
    }

    .prof-actions {
      width: 100%;
    }

    .prof-actions button {
      flex: 1;
    }

    .login-card {
      padding: 24px;
    }

    .container {
      padding: 24px 16px;
    }

    .cart-summary {
      flex-direction: column;
      align-items: flex-start;
    }

    .modal-content {
      margin: 0 16px;
    }

    footer {
      padding: 16px 12px;
    }

    footer p {
      font-size: 12px;
      line-height: 1.5;
    }
  }

  @media (max-width: 480px) {
    .hero h1 {
      font-size: 22px;
    }

    .highlights {
      grid-template-columns: 1fr;
    }

    nav button {
      font-size: 11px;
      padding: 6px 4px;
    }

    .brand {
      font-size: 16px;
    }

    .brand-pill {
      width: 32px;
      height: 32px;
      font-size: 14px;
    }

    footer {
      padding: 12px 8px;
    }

    footer p {
      font-size: 11px;
    }
  }

  .phone-link {
    color: var(--blue-600);
    text-decoration: none;
    font-weight: 600;
    cursor: pointer;
    transition: color 0.2s ease;
  }

  .phone-link:hover {
    color: var(--blue-500);
    text-decoration: underline;
  }

  .btn-call {
    display: none;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    border: none;
    background: linear-gradient(135deg, #4A90E2, #2D7DD2);
    color: #fff;
    font-size: 24px;
    box-shadow: 0 4px 12px rgba(74, 144, 226, 0.4);
    transition: all 0.2s ease;
    flex-shrink: 0;
  }

  .btn-call:hover {
    background: linear-gradient(135deg, #357ABD, #1E5FA8);
    transform: scale(1.05);
  }

  @media (max-width: 768px) {
    .btn-call {
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
  }

  /* Modal Styles */
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 100;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .modal-overlay.active {
    display: flex;
  }

  .modal-content {
    background: var(--bg-surface);
    border-radius: 18px;
    padding: 28px;
    max-width: 450px;
    width: 100%;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .modal-header h3 {
    font-size: 20px;
    margin: 0;
  }

  .modal-close {
    background: none;
    border: none;
    font-size: 28px;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-close:hover {
    color: var(--text-primary);
  }

  .modal-body {
    margin-bottom: 20px;
  }

  .modal-body textarea {
    width: 100%;
    min-height: 220px;
    padding: 12px 14px;
    border-radius: 12px;
    border: 1px solid rgba(148,163,184,0.4);
    background: #fff;
    font-size: 14px;
    color: var(--text-primary);
    font-family: 'Inter', sans-serif;
    resize: vertical;
  }

  .modal-body textarea:focus {
    outline: none;
    border-color: var(--blue-500);
    box-shadow: 0 0 0 3px rgba(37,99,235,0.15);
  }

  .modal-actions {
    display: flex;
    gap: 12px;
  }

  .modal-actions button {
    flex: 1;
    padding: 12px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 15px;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .btn-modal-primary {
    background: var(--green-500);
    color: #fff;
  }

  .btn-modal-primary:hover {
    background: #15803d;
  }

  .btn-modal-secondary {
    background: var(--bg-subtle);
    color: var(--text-primary);
  }

  .btn-modal-secondary:hover {
    background: var(--border-soft);
  }

  .choice-buttons {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 20px;
  }

  .choice-btn {
    padding: 14px;
    border-radius: 12px;
    border: 2px solid var(--border-soft);
    background: var(--bg-surface);
    font-weight: 600;
    font-size: 15px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .choice-btn:hover {
    border-color: var(--blue-500);
    background: rgba(37,99,235,0.05);
  }
</style>
</head>
<body>

<div id="loginScreen">
  <div class="login-card">
    <h2>Welcome back</h2>
    <p>Sign in to access CivilConnect.</p>
    <form id="loginForm">
      <div class="login-field">
        <label for="loginEmail">Email</label>
        <input type="email" id="loginEmail" placeholder="you@example.com" required>
      </div>
      <div class="login-field">
        <label for="loginPassword">Password</label>
        <input type="password" id="loginPassword" placeholder="Enter password" required>
      </div>
      <button type="submit" class="btn-full" style="margin-top:4px;">Sign in</button>
      <div id="loginError" class="login-error"></div>
    </form>
  </div>
</div>

<div id="appShell" style="display:none;">
<header>
  <div class="header-inner">
    <div class="brand"><span class="brand-pill">CC</span> CivilConnect</div>
    <nav>
      <button id="tabHome" class="active">Home</button>
      <button id="tabMarketplace">Marketplace</button>
      <button id="tabProfessionals">Professionals</button>
      <button id="tabTools">Tools</button>
    </nav>
  </div>
</header>

<main>
  <div class="container">
    <section id="homeSection" class="content-section active">
      <div class="card hero">
        <div>
          <h1>Build smarter with CivilConnect</h1>
          <p>Discover vetted suppliers, collaborate with top professionals, and access the tools you need to deliver exceptional civil engineering projects on time.</p>
          <div class="action-row">
            <button class="btn-primary" onclick="switchTab('marketplace')">Explore Marketplace</button>
            <button class="btn-secondary" onclick="switchTab('professionals')">Meet Experts</button>
          </div>
        </div>
      </div>

      <div class="highlights">
        <div class="highlight">
          <span>Active Materials</span>
          <strong>120+</strong>
        </div>
        <div class="highlight">
          <span>Verified Partners</span>
          <strong>85</strong>
        </div>
        <div class="highlight">
          <span>Avg. Lead Time</span>
          <strong>3.2 days</strong>
        </div>
        <div class="highlight">
          <span>Projects Supported</span>
          <strong>640</strong>
        </div>
      </div>
    </section>

    <section id="marketplaceSection" class="content-section">
      <h2 class="section-title">Marketplace</h2>
      <div class="card marketplace-toolbar">
        <div class="field">
          <span>Search materials</span>
          <input type="search" id="searchInput" placeholder="Try &quot;cement&quot; or &quot;steel&quot;">
        </div>
        <div class="field">
          <span>Category</span>
          <select id="categoryFilter"></select>
        </div>
        <div class="field">
          <span>Sort by</span>
          <select id="sortFilter">
            <option value="featured">Featured</option>
            <option value="price-asc">Price: Low to High</option>
            <option value="price-desc">Price: High to Low</option>
            <option value="lead">Shortest Lead Time</option>
          </select>
        </div>
      </div>

      <div class="grid grid-3" id="materialsGrid"></div>
    </section>

    <section id="professionalsSection" class="content-section">
      <h2 class="section-title">Professionals Nearby</h2>
      <div class="grid grid-2" id="professionalsList"></div>
    </section>

    <section id="toolsSection" class="content-section">
      <h2 class="section-title">Project Tools</h2>
      <div class="tool-grid">
        <div class="card">
          <h3>Cost Estimator</h3>
          <div class="field" style="margin-top:18px;">
            <span>Built-up area (sq.ft)</span>
            <input type="number" id="costArea" placeholder="Enter area">
          </div>
          <div class="field" style="margin-top:16px;">
            <span>Rate per sq.ft (‚Çπ)</span>
            <input type="number" id="costRate" value="1500">
          </div>
          <button class="btn-full" style="margin-top:16px;" onclick="calculateCost()">Calculate</button>
          <div id="costResult" class="calculator-output"></div>
        </div>

        <div class="card">
          <h3>Concrete Mix Designer</h3>
          <div class="field" style="margin-top:18px;">
            <span>Concrete grade</span>
            <select id="mixGrade">
              <option>M15</option>
              <option>M20</option>
              <option>M25</option>
              <option>M30</option>
              <option>M35</option>
            </select>
          </div>
          <div class="field" style="margin-top:16px;">
            <span>Volume (m¬≥)</span>
            <input type="number" id="mixVolume" placeholder="Enter required volume">
          </div>
          <button class="btn-full" style="margin-top:16px;" onclick="calculateMix()">Material Breakdown</button>
          <div id="mixResult" class="calculator-output"></div>
        </div>

        <div class="card">
          <h3>Construction Activity Tracker (CAT)</h3>
          <p style="color:var(--text-secondary); margin-top:10px;">Log daily site updates and share progress snapshots across your project stakeholders.</p>
          <div class="field" style="margin-top:18px;">
            <span>Today&apos;s focus</span>
            <input type="text" id="catFocus" placeholder="e.g., Slab reinforcement">
          </div>
          <div class="field" style="margin-top:16px;">
            <span>Key blockers</span>
            <input type="text" id="catBlockers" placeholder="List dependencies or issues">
          </div>
          <div class="field" style="margin-top:16px;">
            <span>Next action</span>
            <input type="text" id="catNext" placeholder="Assign owner & deadline">
          </div>
          <button class="btn-full" style="margin-top:16px;" onclick="logCatUpdate()">Save update</button>
          <div id="catResult" class="calculator-output" style="display:none;"></div>
        </div>
      </div>
    </section>
  </div>
</main>

<div id="cartSidebar" class="cart-sidebar">
  <div class="cart-sidebar-header">
    <button id="cartToggle" style="background:none;border:none;font-size:20px;color:var(--text-secondary);cursor:pointer;">√ó</button>
    <div style="flex:1;text-align:center;">
      <h3>Smart Cart</h3>
      <small class="cart-stats">Items: <strong id="cartCount">0</strong></small>
    </div>
  </div>
  <div class="cart-sidebar-body">
    <div id="cartItems" class="cart-list"></div>
    <div id="cartEmptyState" class="cart-empty">Your cart is empty. Add materials to build a procurement list.</div>
    <div class="cart-summary">
      <div>
        <h3>Total</h3>
        <span id="cartLeadTime">Lead time updates as you add materials.</span>
      </div>
      <div>
        <strong id="cartTotal">‚Çπ0</strong>
      </div>
    </div>
    <button class="checkout-btn" onclick="checkout()">Proceed to Checkout</button>
  </div>
</div>

<footer>
  <p>CivilConnect ¬© 2025 ¬∑ Transforming Civil Engineering by connecting professionals, suppliers, and innovation.</p>
</footer>

</div>

<!-- Choice Modal (Mobile only) -->
<div id="choiceModal" class="modal-overlay" onclick="if(event.target === this) closeChoiceModal()">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Contact <span id="choiceProfName"></span></h3>
      <button class="modal-close" onclick="closeChoiceModal()">√ó</button>
    </div>
    <div class="modal-body">
      <p style="color: var(--text-secondary); margin-bottom: 16px;">Choose how you'd like to send your request:</p>
      <div class="choice-buttons">
        <button class="choice-btn" onclick="chooseMessaging('whatsapp')">
          <span style="font-size: 20px;">üí¨</span> WhatsApp
        </button>
        <button class="choice-btn" onclick="chooseMessaging('sms')">
          <span style="font-size: 20px;">üì±</span> SMS / Messages
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Message Template Modal -->
<div id="messageModal" class="modal-overlay" onclick="if(event.target === this) closeMessageModal()">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Request to <span id="modalProfName"></span></h3>
      <button class="modal-close" onclick="closeMessageModal()">√ó</button>
    </div>
    <div class="modal-body">
      <p style="color: var(--text-secondary); margin-bottom: 12px; font-size: 14px;">Edit the message below and add your details:</p>
      <textarea id="messageText" placeholder="Enter your message..."></textarea>
    </div>
    <div class="modal-actions">
      <button class="btn-modal-secondary" onclick="closeMessageModal()">Cancel</button>
      <button class="btn-modal-primary" onclick="sendMessage()">Send Message</button>
    </div>
  </div>
</div>

<script>
  const tabIds = ['home','marketplace','professionals','tools'];
  const AUTH_EMAIL = 'test@gmail.com';
  const AUTH_PASSWORD = 'test123';
  const AUTH_KEY = 'civilconnect-auth';

  const loginForm = document.getElementById('loginForm');
  const loginEmail = document.getElementById('loginEmail');
  const loginPassword = document.getElementById('loginPassword');
  const loginError = document.getElementById('loginError');

  function isAuthenticated(){
    return sessionStorage.getItem(AUTH_KEY) === 'true';
  }

  function showApp(){
    const appShell = document.getElementById('appShell');
    const loginScreen = document.getElementById('loginScreen');
    const cartSidebar = document.getElementById('cartSidebar');
    const container = document.querySelector('.container');
    const headerInner = document.querySelector('.header-inner');
    appShell.style.display = 'flex';
    loginScreen.style.display = 'none';
    if(cartSidebar){ cartSidebar.classList.remove('open'); }
    if(container){ container.classList.remove('sidebar-open'); }
    if(headerInner){ headerInner.classList.remove('sidebar-open'); }
    if(loginError){ loginError.textContent = ''; }
  }

  function showLogin(){
    const appShell = document.getElementById('appShell');
    const loginScreen = document.getElementById('loginScreen');
    const cartSidebar = document.getElementById('cartSidebar');
    const container = document.querySelector('.container');
    const headerInner = document.querySelector('.header-inner');
    appShell.style.display = 'none';
    loginScreen.style.display = 'flex';
    if(cartSidebar){ cartSidebar.classList.remove('open'); }
    if(container){ container.classList.remove('sidebar-open'); }
    if(headerInner){ headerInner.classList.remove('sidebar-open'); }
    if(loginForm){ loginForm.reset(); }
    if(loginError){ loginError.textContent = ''; }
  }

  function switchTab(tab){
    if(!isAuthenticated()){
      showLogin();
      return;
    }
    tabIds.forEach(t=>{
      const section = document.getElementById(t+'Section');
      const button = document.getElementById('tab'+t.charAt(0).toUpperCase()+t.slice(1));
      section.classList.remove('active');
      button.classList.remove('active');
    });
    document.getElementById(tab+'Section').classList.add('active');
    document.getElementById('tab'+tab.charAt(0).toUpperCase()+tab.slice(1)).classList.add('active');
    if(tab === 'marketplace'){
      state.search = '';
      state.category = 'all';
      state.sort = 'featured';
      searchInput.value = '';
      categoryFilter.value = 'all';
      sortFilter.value = 'featured';
      renderMaterials();
    }
    window.scrollTo({top:0, behavior:'smooth'});
  }

  document.getElementById('tabHome').onclick = ()=>switchTab('home');
  document.getElementById('tabMarketplace').onclick = ()=>switchTab('marketplace');
  document.getElementById('tabProfessionals').onclick = ()=>switchTab('professionals');
  document.getElementById('tabTools').onclick = ()=>switchTab('tools');

  const materials = [
    {id:1,name:'Portland Cement (50kg)',price:450,supplier:'BuildMart Supplies',emoji:'üèóÔ∏è',category:'Concrete',leadTime:2,unit:'bag',stock:'In stock'},
    {id:2,name:'Steel Rebar 12mm',price:850,supplier:'MetalWorks Ltd',emoji:'‚öôÔ∏è',category:'Steel',leadTime:3,unit:'per bundle',stock:'Low stock'},
    {id:3,name:'Ready Mix Concrete M25',price:5500,supplier:'ConcreteXpress',emoji:'üöö',category:'Concrete',leadTime:1,unit:'per load',stock:'Scheduled'},
    {id:4,name:'Clay Bricks (1000 pcs)',price:6000,supplier:'BrickMasters',emoji:'üß±',category:'Masonry',leadTime:4,unit:'per pallet',stock:'In stock'},
    {id:5,name:'River Sand (1 ton)',price:1200,supplier:'Aggregate Hub',emoji:'‚õ∞Ô∏è',category:'Aggregates',leadTime:2,unit:'per ton',stock:'In stock'},
    {id:6,name:'Plywood 18mm',price:2200,supplier:'WoodCraft Pro',emoji:'ü™µ',category:'Formwork',leadTime:5,unit:'per sheet',stock:'Preorder'},
    {id:7,name:'PVC Pipes (110mm)',price:950,supplier:'FlowTech Systems',emoji:'üõ†Ô∏è',category:'Plumbing',leadTime:3,unit:'per pack',stock:'In stock'},
    {id:8,name:'Structural Steel Beam HEB 200',price:7800,supplier:'SteelCore Industries',emoji:'üèóÔ∏è',category:'Steel',leadTime:6,unit:'per piece',stock:'Limited'},
    {id:9,name:'Ready Mix Mortar',price:1450,supplier:'QuickSet Mixers',emoji:'üß™',category:'Concrete',leadTime:2,unit:'per bag',stock:'In stock'}
  ];

  const professionals = [
    {name:'Naveen',role:'Civil Contractor',experience:'100 years',rating:5.0,distance:'Nearby',projects:1500,availability:'Available for large projects',phone:'8110056833'},
    {name:'L. Yuvaraj',role:'Civil Contractor',experience:'35 years',rating:4.8,distance:'Nearby',projects:150,availability:'Available for large projects',phone:'9943967334'},
    {name:'R. Karthikeyan',role:'Civil Contractor',experience:'35 years',rating:4.7,distance:'Nearby',projects:140,availability:'Experienced contractor',phone:'9443238254'},
    {name:'A. Akilan',role:'Supervisor',experience:'25 years',rating:4.6,distance:'Nearby',projects:80,availability:'Site supervision available',phone:'9443091304'},
    {name:'Kumar',role:'Mason',experience:'20 years',rating:4.5,distance:'Nearby',projects:60,availability:'Brickwork specialist',phone:'9442001297'},
    {name:'Perumal',role:'Plumber',experience:'15 years',rating:4.4,distance:'Nearby',projects:45,availability:'Plumbing services',phone:'9842074892'},
    {name:'Namashivayam',role:'Electrician',experience:'15 years',rating:4.3,distance:'Nearby',projects:40,availability:'Electrical work',phone:'9789378287'},
    {name:'Manohar',role:'Carpenter',experience:'15 years',rating:4.4,distance:'Nearby',projects:50,availability:'Woodwork expert',phone:'9443201202'},
    {name:'Kasinathan',role:'Shuttering and Bar Bending Work',experience:'15 years',rating:4.5,distance:'Nearby',projects:55,availability:'Reinforcement specialist',phone:'9443285681'},
    {name:'Shenavas',role:'Architect',experience:'30 years',rating:4.9,distance:'Nearby',projects:120,availability:'Design consultations',phone:'9443718476'},
    {name:'Ponnusamy',role:'Structural Engineer',experience:'15 years',rating:4.6,distance:'Nearby',projects:70,availability:'Structural analysis',phone:'9444010908'},
    {name:'Prakash',role:'Painter',experience:'15 years',rating:4.2,distance:'Nearby',projects:35,availability:'Painting services',phone:'8610494790'}
  ];

  const materialsGrid = document.getElementById('materialsGrid');
  const categoryFilter = document.getElementById('categoryFilter');
  const sortFilter = document.getElementById('sortFilter');
  const searchInput = document.getElementById('searchInput');

  const uniqueCategories = ['All categories', ...new Set(materials.map(item=>item.category))];
  categoryFilter.innerHTML = uniqueCategories.map((cat,idx)=>`<option value="${idx===0?'all':cat}">${cat}</option>`).join('');

  const state = {search:'', category:'all', sort:'featured'};

  searchInput.addEventListener('input', e=>{
    state.search = e.target.value.toLowerCase();
    renderMaterials();
  });

  categoryFilter.addEventListener('change', e=>{
    state.category = e.target.value;
    renderMaterials();
  });

  sortFilter.addEventListener('change', e=>{
    state.sort = e.target.value;
    renderMaterials();
  });

  let cart = [];

  let bookmarked = new Set();

  function checkout(){
    if(cart.length === 0){
      alert('Your cart is empty.');
      return;
    }
    alert('Products checked out successfully!');
    cart = [];
    renderCart();
  }

  function getFilteredMaterials(){
    let filtered = materials.filter(item=>{
      const matchesSearch = item.name.toLowerCase().includes(state.search) || item.supplier.toLowerCase().includes(state.search);
      const matchesCategory = state.category === 'all' || item.category === state.category;
      return matchesSearch && matchesCategory;
    });

    if(state.sort === 'price-asc'){
      filtered = filtered.slice().sort((a,b)=>a.price-b.price);
    } else if(state.sort === 'price-desc'){
      filtered = filtered.slice().sort((a,b)=>b.price-a.price);
    } else if(state.sort === 'lead'){
      filtered = filtered.slice().sort((a,b)=>a.leadTime-b.leadTime);
    }
    return filtered;
  }

  function renderMaterials(){
    materialsGrid.innerHTML = '';
    const list = getFilteredMaterials();
    if(list.length === 0){
      const emptyCard = document.createElement('div');
      emptyCard.className = 'card';
      emptyCard.innerHTML = '<p style="text-align:center;color:var(--text-secondary);">No materials match your filters right now.</p>';
      materialsGrid.appendChild(emptyCard);
      return;
    }
    list.forEach(item=>{
      const card = document.createElement('div');
      card.className = 'card material-card';
      card.innerHTML = `
        <div class="material-header">
          <span class="material-emoji">${item.emoji}</span>
          <span class="material-category">${item.category}</span>
        </div>
        <div>
          <h3>${item.name}</h3>
          <p style="color:var(--text-secondary); margin-top:6px;">${item.supplier}</p>
        </div>
        <div class="material-meta">
          <span>‚Çπ${item.price.toLocaleString()}</span>
          <span>${item.unit}</span>
        </div>
        <div class="material-foot">
          <span>Lead time: ${item.leadTime} day${item.leadTime>1?'s':''}</span>
          <span>${item.stock}</span>
        </div>
        <button class="btn-full" onclick="addToCart(${item.id})">Add to cart</button>
      `;
      materialsGrid.appendChild(card);
    });
  }

  function addToCart(id){
    const existing = cart.find(entry=>entry.id===id);
    if(existing){
      existing.quantity += 1;
    } else {
      const material = materials.find(item=>item.id===id);
      cart.push({...material, quantity:1});
    }
    renderCart();
  }

  function changeQuantity(id, delta){
    const item = cart.find(entry=>entry.id===id);
    if(!item){return;}
    item.quantity += delta;
    if(item.quantity <= 0){
      cart = cart.filter(entry=>entry.id!==id);
    }
    renderCart();
  }

  function removeFromCart(id){
    cart = cart.filter(entry=>entry.id!==id);
    renderCart();
  }

  function renderCart(){
    const cartSidebar = document.getElementById('cartSidebar');
    const container = document.querySelector('.container');
    const headerInner = document.querySelector('.header-inner');
    const cartItemsDiv = document.getElementById('cartItems');
    const cartCount = document.getElementById('cartCount');
    const cartTotal = document.getElementById('cartTotal');
    const cartLeadTime = document.getElementById('cartLeadTime');
    const cartEmptyState = document.getElementById('cartEmptyState');

    cartItemsDiv.innerHTML = '';
    if(cart.length === 0){
      cartEmptyState.style.display = 'block';
      cartTotal.textContent = '‚Çπ0';
      cartLeadTime.textContent = 'Lead time updates as you add materials.';
      cartSidebar.classList.remove('open');
      container.classList.remove('sidebar-open');
      headerInner.classList.remove('sidebar-open');
      document.getElementById('cartCount').textContent = '0';
      return;
    }

    cartEmptyState.style.display = 'none';
    cartSidebar.classList.add('open');
    container.classList.add('sidebar-open');
    headerInner.classList.add('sidebar-open');

    let totalCost = 0;
    let totalItems = 0;
    let longestLead = 0;

    cart.forEach(item=>{
      totalCost += item.price * item.quantity;
      totalItems += item.quantity;
      longestLead = Math.max(longestLead, item.leadTime);

      const row = document.createElement('div');
      row.className = 'cart-item';
      row.innerHTML = `
        <div>
          <h4>${item.name}</h4>
          <p>‚Çπ${item.price.toLocaleString()} ¬∑ ${item.unit} ¬∑ Lead ${item.leadTime}d</p>
        </div>
        <div class="quantity-group">
          <button class="quantity-btn" onclick="changeQuantity(${item.id}, -1)">-</button>
          <strong>${item.quantity}</strong>
          <button class="quantity-btn" onclick="changeQuantity(${item.id}, 1)">+</button>
        </div>
        <div style="text-align:right;">
          <strong>‚Çπ${(item.price * item.quantity).toLocaleString()}</strong><br>
          <button class="text-link" onclick="removeFromCart(${item.id})">Remove</button>
        </div>
      `;
      cartItemsDiv.appendChild(row);
    });

    cartTotal.textContent = '‚Çπ' + totalCost.toLocaleString();
    cartLeadTime.textContent = `Estimated combined lead time: ${longestLead} day${longestLead>1?'s':''}`;
    document.getElementById('cartCount').textContent = totalItems.toString();
  }

  const profDiv = document.getElementById('professionalsList');
  professionals.forEach(prof=>{
    const card = document.createElement('div');
    card.className = 'card prof-card';
    const initials = prof.name.split(' ').map(part=>part[0]).join('').slice(0,2).toUpperCase();
    card.innerHTML = `
      <div class="prof-head">
        <div class="prof-avatar">${initials}</div>
        <div style="flex: 1;">
          <h3>${prof.name}</h3>
          <p class="prof-meta">${prof.role} ¬∑ ${prof.experience}</p>
          <p class="prof-meta">üìû ${prof.phone}</p>
          <div class="prof-actions">
            <span class="tag">‚≠ê ${prof.rating}</span>
            <span class="tag">üìç ${prof.distance}</span>
          </div>
        </div>
        <button class="btn-call" onclick="directCall('${prof.phone}')" title="Call ${prof.name}">üìû</button>
      </div>
      <div class="prof-meta">${prof.projects} completed projects ¬∑ ${prof.availability}</div>
      <div class="prof-actions">
        <button class="btn-primary" style="min-width:140px;" onclick="requestCall('${prof.name}', '${prof.phone}', '${prof.role}')">Request call</button>
        <button class="btn-secondary" style="min-width:140px;" onclick="bookmarkExpert('${prof.name}')">Bookmark</button>
      </div>
    `;
    profDiv.appendChild(card);
  });

  function directCall(phone) {
    // This button only shows on mobile, so directly open dialer
    // Remove any spaces from phone number
    phone = phone.replace(/\s+/g, '');
    window.location.href = `tel:${phone}`;
  }

  function requestCall(name, phone, role) {
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
    
    if (isMobile) {
      // Show choice modal on mobile
      showChoiceModal(name, phone, role);
    } else {
      // Desktop - directly open WhatsApp with template
      showMessageModal(name, phone, role, 'whatsapp');
    }
  }

  function showChoiceModal(name, phone, role) {
    const modal = document.getElementById('choiceModal');
    document.getElementById('choiceProfName').textContent = name;
    
    // Store data for later use
    modal.dataset.name = name;
    modal.dataset.phone = phone;
    modal.dataset.role = role;
    
    modal.classList.add('active');
  }

  function closeChoiceModal() {
    document.getElementById('choiceModal').classList.remove('active');
  }

  function chooseMessaging(type) {
    const modal = document.getElementById('choiceModal');
    const name = modal.dataset.name;
    const phone = modal.dataset.phone;
    const role = modal.dataset.role;
    
    closeChoiceModal();
    showMessageModal(name, phone, role, type);
  }

  function showMessageModal(name, phone, role, type) {
    const modal = document.getElementById('messageModal');
    const messageText = document.getElementById('messageText');
    
    // Default template message
    const template = `Hello ${name},\n\nI would like to request your services for my construction project.\n\nRole: ${role}\n\nPlease provide the following details:\n- Your Name:\n- Project Location:\n- Project Type:\n- Expected Start Date:\n- Additional Requirements:\n\nLooking forward to your response.\n\nThank you!`;
    
    messageText.value = template;
    
    // Store data for sending
    modal.dataset.phone = phone;
    modal.dataset.name = name;
    modal.dataset.type = type;
    
    document.getElementById('modalProfName').textContent = name;
    modal.classList.add('active');
  }

  function closeMessageModal() {
    document.getElementById('messageModal').classList.remove('active');
  }

  function sendMessage() {
    const modal = document.getElementById('messageModal');
    const message = document.getElementById('messageText').value.trim();
    let phone = modal.dataset.phone;
    const type = modal.dataset.type;
    const name = modal.dataset.name;
    
    if (!message) {
      alert('Please enter a message');
      return;
    }
    
    closeMessageModal();
    
    // Remove any spaces from phone number
    phone = phone.replace(/\s+/g, '');
    
    // Encode message for URL
    const encodedMessage = encodeURIComponent(message);
    
    if (type === 'whatsapp') {
      // Open WhatsApp
      window.open(`https://wa.me/91${phone}?text=${encodedMessage}`, '_blank');
    } else if (type === 'sms') {
      // Open SMS
      window.location.href = `sms:${phone}?body=${encodedMessage}`;
    }
  }

  function handlePhoneClick(phone, event) {
    event.preventDefault();
    
    // Check if device is mobile
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
    
    if (isMobile) {
      // On mobile, open phone dialer
      window.location.href = `tel:${phone}`;
    } else {
      // On desktop, open WhatsApp
      window.open(`https://wa.me/91${phone}`, '_blank');
    }
  }

  function bookmarkExpert(name){
    const cards = document.querySelectorAll('.prof-card');
    cards.forEach(card => {
      if(card.querySelector('h3').textContent === name){
        if(bookmarked.has(name)){
          bookmarked.delete(name);
          card.classList.remove('bookmarked');
          alert(`${name} has been unbookmarked.`);
        } else {
          bookmarked.add(name);
          card.classList.add('bookmarked');
          alert(`${name} has been bookmarked.`);
        }
      }
    });
  }

  function calculateCost(){
    const area = parseFloat(document.getElementById('costArea').value) || 0;
    const rate = parseFloat(document.getElementById('costRate').value) || 0;
    if(area <= 0 || rate <= 0){
      document.getElementById('costResult').textContent = 'Enter valid values to calculate cost.';
      return;
    }
    const total = area * rate;
    document.getElementById('costResult').textContent = `Estimated Cost: ‚Çπ${total.toLocaleString()}`;
  }

  function calculateMix(){
    const volume = parseFloat(document.getElementById('mixVolume').value) || 0;
    const grade = document.getElementById('mixGrade').value;
    if(volume <= 0){
      document.getElementById('mixResult').textContent = 'Enter a valid volume to continue.';
      return;
    }
    const cement = (volume * 7.5).toFixed(2);
    const sand = (volume * 0.42).toFixed(2);
    const aggregate = (volume * 0.84).toFixed(2);
    const water = (volume * 180).toFixed(0);
    document.getElementById('mixResult').innerHTML = `
      <div>${grade} mix breakdown</div>
      <div>Cement: ${cement} bags</div>
      <div>Sand: ${sand} m¬≥</div>
      <div>Aggregate: ${aggregate} m¬≥</div>
      <div>Water: ${water} liters</div>
    `;
  }

  function logCatUpdate(){
    const focusField = document.getElementById('catFocus');
    const blockersField = document.getElementById('catBlockers');
    const nextField = document.getElementById('catNext');
    const focus = focusField.value.trim();
    const blockers = blockersField.value.trim();
    const next = nextField.value.trim();
    if(!focus && !blockers && !next){
      alert('Add at least one update before saving.');
      return;
    }
    const result = document.getElementById('catResult');
    const today = new Date().toLocaleDateString();
    result.style.display = 'block';
    result.innerHTML = `
      <div>CAT update saved for ${today}</div>
      <div>Focus: ${focus || '‚Äî'}</div>
      <div>Blockers: ${blockers || '‚Äî'}</div>
      <div>Next action: ${next || '‚Äî'}</div>
    `;
    focusField.value = '';
    blockersField.value = '';
    nextField.value = '';
  }

  document.getElementById('cartToggle').addEventListener('click', ()=>{
    const cartSidebar = document.getElementById('cartSidebar');
    const container = document.querySelector('.container');
    const headerInner = document.querySelector('.header-inner');
    cartSidebar.classList.toggle('open');
    if(cartSidebar.classList.contains('open')){
      container.classList.add('sidebar-open');
      headerInner.classList.add('sidebar-open');
    } else {
      container.classList.remove('sidebar-open');
      headerInner.classList.remove('sidebar-open');
    }
  });

  function handleLogin(event){
    event.preventDefault();
    const email = (loginEmail.value || '').trim().toLowerCase();
    const password = loginPassword.value || '';
    if(email === AUTH_EMAIL && password === AUTH_PASSWORD){
  sessionStorage.setItem(AUTH_KEY, 'true');
      if(loginForm){ loginForm.reset(); }
      showApp();
      switchTab('home');
    } else {
      if(loginError){ loginError.textContent = 'Invalid email or password.'; }
    }
  }

  if(loginForm){
    loginForm.addEventListener('submit', handleLogin);
  }

  function initializeAuth(){
    if(isAuthenticated()){
      showApp();
      switchTab('home');
    } else {
      showLogin();
    }
  }

  renderMaterials();
  renderCart();
  initializeAuth();
</script>

</body>
</html>
